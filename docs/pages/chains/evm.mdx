# EVM Chain Implementation

This implementation supports all EVM-compatible networks (Ethereum, Binance Smart Chain, Polygon, etc.).

## Configuration

```ts twoslash filename="base.ts"
// [!include ~/snippets/contract.ts]
// ---cut---
import { EVM } from 'signet.js'

// Initialize the chain
const evmChain = new EVM({
  rpcUrl: 'https://mainnet.infura.io/v3/YOUR-PROJECT-ID',
  contract,
})
```

## Public Methods

### getBalance

Gets the native token balance of an address in ETH units.

```ts twoslash
// [!include base.ts]
// ---cut---
const balance = await evmChain.getBalance('0x...')
```

**Parameters:**

- `address`: The Ethereum address to check

**Returns:**

- The balance in ETH as a string

### deriveAddressAndPublicKey

Derives an Ethereum address and public key from a signer ID and derivation path.

```ts twoslash
// [!include base.ts]
// ---cut---
const { address, publicKey } = await evmChain.deriveAddressAndPublicKey(
  '0x...',
  'any_string'
)
```

**Parameters:**

- `predecessor`: The ID/address of the signer requesting the signature
- `path`: The derivation path to use

**Returns:**

- Object containing:
  - `address`: The derived Ethereum address
  - `publicKey`: The corresponding public key in SEC1 uncompressed format

### getMPCPayloadAndTransaction

Prepares a transaction for MPC signing.

```ts twoslash
// [!include base.ts]
// ---cut---
import { EVMTransactionRequest } from 'signet.js'

const transactionRequest: EVMTransactionRequest = {
  to: '0x...',
  from: '0x...',
  value: '100000000000000000',
  data: '0x...',
}

const { transaction, mpcPayloads } =
  await evmChain.getMPCPayloadAndTransaction(transactionRequest)
```

The transaction is enhanced with:

- Gas estimation
- Nonce calculation
- Chain ID
- EIP-1559 fee parameters

### addSignature

Adds a signature to an unsigned transaction.

```typescript
addSignature(params: {
  transaction: EVMUnsignedTransaction
  mpcSignatures: RSVSignature[]
}): string
```

**Parameters:**

- `transaction`: The unsigned transaction
- `mpcSignatures`: Array of RSV signatures from MPC

**Returns:**

- The serialized signed transaction

### broadcastTx

Broadcasts a signed transaction to the network.

```typescript
async broadcastTx(txSerialized: string): Promise<string>
```

**Parameters:**

- `txSerialized`: The serialized signed transaction

**Returns:**

- The transaction hash

**Throws:**

- Error if broadcast fails

## Adding New EVM Chains

To add support for a new EVM-compatible chain, you only need to configure the provider URL. The chain ID and network configuration are automatically retrieved from the provider.

```typescript
// For Polygon (Matic)
const polygonChain = new EVM({
  rpcUrl: 'https://polygon-rpc.com',
  contract: new ChainSignatureContract(...),
})

// For Binance Smart Chain
const bscChain = new EVM({
  rpcUrl: 'https://bsc-dataseed.binance.org',
  contract: new ChainSignatureContract(...),
})

// For Arbitrum
const arbitrumChain = new EVM({
  rpcUrl: 'https://arb1.arbitrum.io/rpc',
  contract: new ChainSignatureContract(...),
})
```

## Technical Details

The implementation:

- Uses ethers.js v6 internally
- Supports EIP-1559 transactions
- Handles gas estimation automatically
- Manages nonce calculation
- Supports all standard EVM operations
